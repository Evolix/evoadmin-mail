#!/bin/sh

# Pré-requis pour utiliser ce script :
# * Evoadmin-mail est installé dans /home/evoadminmail/www
# * Etre loggué avec le compte evoadminmail (sudo su evoadminmail)

# Note : Ce script utilise une connexion SVN anonyme pour récupérer le code source
# Note : Ce script ne met *pas* en prod le script evoadmin.sh dans /usr/share/scripts

SVNREPO="svn://svn.evolix.org/svn/packmail/trunk/evoadmin"

tmpdir=`mktemp -d $HOME/tmp.XXXXXX`
svn export --force $SVNREPO $tmpdir
rsync -rlvc --delete --exclude conf.php --exclude connect.php $tmpdir/ /home/evoadminmail/www
rm -rf $tmpdir
svn info $SVNREPO | mail -s "Mise en prod Evoadmin-mail ($HOSTNAME)" root

